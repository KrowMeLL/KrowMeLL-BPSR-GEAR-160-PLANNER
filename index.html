<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RaoH | S2 BPSR 160 Gear Planner Tool</title>
    <style>
        /* =========================================
           CSS STYLING & LAYOUT
           ========================================= */
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: radial-gradient(circle at top, #23232e, #13131a); /* Fundo com gradiente */
            color: #e0e0e0; 
            padding: 20px; 
            display: flex; 
            justify-content: center; 
            min-height: 100vh;
        }

        .main-wrapper { 
            display: flex; 
            flex-direction: row; 
            gap: 25px; 
            width: 100%; 
            max-width: 1600px; 
            flex-wrap: wrap; 
        }
        
        /* --- Painéis Principais --- */
        .panel { 
            background-color: #1e1e2e; 
            padding: 30px; 
            border-radius: 16px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            border: 1px solid #2f2f40;
        }
        .planner-panel { flex: 3; min-width: 900px; }
        .calc-panel { 
            flex: 1; 
            min-width: 300px; 
            position: sticky; 
            top: 20px; 
            height: fit-content; 
            background: linear-gradient(160deg, #1e1e2e 0%, #16161f 100%);
        }

        h2 { 
            text-align: center; 
            color: #7aa2f7; 
            margin-top: 0; 
            text-transform: uppercase; 
            letter-spacing: 1px;
            font-size: 1.5rem;
        }
        
        /* --- Sistema de Abas --- */
        .tab-container {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #333;
        }
        .tab-btn {
            background: none;
            border: none;
            color: #666;
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .tab-btn:hover { color: #fff; }
        .tab-btn.active {
            color: #7aa2f7;
            border-bottom: 3px solid #7aa2f7;
            text-shadow: 0 0 10px rgba(122, 162, 247, 0.3);
        }
        .tab-content { display: none; animation: fadeIn 0.3s ease; }
        .tab-content.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- Controles Globais --- */
        .global-controls {
            background: linear-gradient(90deg, #252535 0%, #2a2a3c 100%);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
            border: 1px solid #444;
        }
        .global-label { color: #ff9e64; font-weight: bold; font-size: 0.9em; white-space: nowrap; }

        /* --- Grid de Equipamentos --- */
        .controls-row {
            display: flex; 
            gap: 20px; 
            justify-content: center; 
            margin-bottom: 20px; 
            background: #2a2a3c; 
            padding: 15px; 
            border-radius: 8px; 
            align-items: center;
            flex-wrap: wrap;
            border: 1px solid #3b3b4f;
        }
        .radio-group { display: flex; gap: 20px; }
        .radio-label { cursor: pointer; font-weight: bold; color: #a9b1d6; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .radio-label:hover { color: #fff; }
        input[type="radio"] { transform: scale(1.2); accent-color: #7aa2f7; }
        
        .spec-select-group { display: flex; align-items: center; gap: 10px; }
        .spec-select-group label { color: #9ece6a; font-weight: bold; }

        /* Linhas da Tabela */
        .gear-row { 
            display: grid; 
            grid-template-columns: 1fr 0.4fr 0.8fr 0.8fr 0.8fr 1.4fr 1.2fr; 
            gap: 10px; 
            align-items: center; 
            padding: 10px 15px; 
            border-bottom: 1px solid #2f2f40; 
            transition: background 0.2s;
        }
        .gear-row:hover { background-color: rgba(255,255,255,0.02); }
        .gear-header { 
            font-weight: bold; 
            color: #9ece6a; 
            padding-bottom: 10px; 
            border-bottom: 2px solid #444; 
            margin-bottom: 10px; 
            font-size: 0.9em;
            background-color: transparent !important;
        }
        .slot-name { font-weight: bold; color: #fff; font-size: 0.95em; }
        
        /* Inputs e Selects */
        select, input[type="number"] { 
            width: 100%; 
            padding: 8px 10px; 
            border-radius: 6px; 
            border: 1px solid #444; 
            background-color: #13131a; 
            color: white; 
            font-size: 0.9em;
            transition: border 0.2s;
        }
        select:focus, input:focus { border-color: #7aa2f7; outline: none; }
        select:disabled { opacity: 0.5; cursor: not-allowed; background-color: #1a1a20; border-color: #333; color: #777; }
        input[type="checkbox"] { transform: scale(1.3); accent-color: #f7768e; cursor: pointer; }

        /* --- Imagine Section --- */
        .imagine-section {
            margin-top: 25px;
            background-color: #232330;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #3b3b4f;
        }
        .imagine-row {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
        }
        .imagine-title { color: #ff9e64; font-weight: bold; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 5px; }

        /* --- Legendary & Results --- */
        .leg-group { display: flex; gap: 5px; }
        .leg-val { width: 50px; text-align: center; }

        .raw-gear-stats {
            background-color: #13131a;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
        }
        .raw-row { display: flex; justify-content: space-between; font-size: 0.95em; padding: 4px 0; border-bottom: 1px solid #1f1f2a; }
        .raw-val { color: #7dcfff; font-weight: bold; }

        .base-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .input-group label { display: block; font-size: 0.8em; color: #bb9af7; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

        /* Botões */
        button.calc-btn { 
            width: 100%; 
            padding: 14px; 
            background: linear-gradient(45deg, #7aa2f7, #5c85d6);
            color: #fff; 
            font-weight: bold; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            margin-top: 15px; 
            transition: transform 0.1s, box-shadow 0.2s; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        button.calc-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(122, 162, 247, 0.4); }
        
        .results-area { margin-top: 25px; border-top: 2px solid #333; padding-top: 20px; }
        .result-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #333; font-size: 1.05em; }
        .result-val { font-weight: bold; color: #9ece6a; }
        
        .legendary-note { font-size: 0.85em; color: #6c7596; font-style: italic; margin-top: 20px; line-height: 1.6; background: #1a1a24; padding: 15px; border-radius: 8px; border-left: 3px solid #7aa2f7; }

        /* --- OTIMIZADOR --- */
        .optimizer-intro { margin-bottom: 25px; color: #a9b1d6; line-height: 1.6; background: #232330; padding: 15px; border-radius: 8px;}
        .opt-input-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .opt-input-group label { color: #9ece6a; font-weight: bold; display: block; margin-bottom: 5px;}
        
        .optimize-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(45deg, #f7768e, #db4b66);
            color: white;
            font-weight: bold;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        .optimize-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(247, 118, 142, 0.4); }
        
        .opt-status { text-align: center; margin-top: 15px; font-weight: bold; color: #ff9e64; min-height: 24px; font-size: 1.1em; }
        .opt-options { display: flex; justify-content: center; gap: 25px; margin-top: 20px; flex-wrap: wrap; background: #232330; padding: 10px; border-radius: 8px;}
        .opt-check-label { color: #ff9e64; cursor: pointer; font-weight: bold; font-size: 0.9em; display: flex; align-items: center; gap: 6px; }

        /* --- CREDITS FOOTER --- */
        .footer-credits {
            width: 100%;
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
            color: #565f89;
            font-size: 0.85rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

    </style>
</head>
<body>

<div class="main-wrapper">

    <div class="panel planner-panel">
        <h2>RaoH | S2 BPSR 160 Gear Planner Tool</h2>
        
        <div class="tab-container">
            <button class="tab-btn active" onclick="switchTab('planner')">Gear Planner</button>
            <button class="tab-btn" onclick="switchTab('optimizer')">Auto-Optimizer</button>
        </div>

        <div class="controls-row">
            <div class="radio-group">
                <label class="radio-label"><input type="radio" name="buildType" value="Strength" checked onchange="updateAllRows()"> Strength</label>
                <label class="radio-label"><input type="radio" name="buildType" value="Intelligence" onchange="updateAllRows()"> Intelligence</label>
                <label class="radio-label"><input type="radio" name="buildType" value="Agility" onchange="updateAllRows()"> Agility</label>
            </div>
            
            <div style="width: 1px; height: 30px; background: #555; margin: 0 10px;"></div>

            <div class="spec-select-group">
                <label>Class Spec:</label>
                <select id="class-spec" onchange="updateAllRows()">
                    </select>
            </div>
        </div>

        <div id="tab-planner" class="tab-content active">
            
            <div class="global-controls">
                <span class="global-label">Quick Actions:</span>
                <select id="global-reforge" onchange="applyGlobal('reforge', this.value)">
                    <option value="">Reforge (Set All)</option>
                    <option value="Versatility">Versatility</option>
                    <option value="Mastery">Mastery</option>
                    <option value="Haste">Haste</option>
                    <option value="Crit">Crit</option>
                    <option value="Luck">Luck</option>
                </select>
            </div>

            <div class="gear-row gear-header">
                <div>Slot</div>
                <div style="text-align:center">Raid?</div>
                <div>Primary</div>
                <div>Secondary</div>
                <div>Reforge</div>
                <div>Legendary (WIP)</div>
            </div>

            <div id="gear-container"></div>
        </div>

        <div id="tab-optimizer" class="tab-content">
            <h3>Target Percentages</h3>
            <div class="optimizer-intro">
                Enter your targets below. The algorithm will simulate thousands of combinations to find the closest match.
                <ul style="margin-top:10px; font-size:0.9em; color:#888; list-style-type: square; padding-left: 20px;">
                    <li><strong>Smart Raid:</strong> Automatically picks optimal Raid pieces based on limits.</li>
                    <li><strong>Smart Logic:</strong> Prioritizes stat caps first, then efficiency (lower gem levels), then uniformity.</li>
                </ul>
            </div>

            <div class="opt-input-grid">
                <div class="opt-input-group">
                    <label>Target Versatility %</label>
                    <input type="number" id="opt-vers" placeholder="e.g. 10">
                </div>
                <div class="opt-input-group">
                    <label>Target Mastery %</label>
                    <input type="number" id="opt-mast" placeholder="e.g. 50">
                </div>
                <div class="opt-input-group">
                    <label>Target Haste %</label>
                    <input type="number" id="opt-haste" placeholder="e.g. 20">
                </div>
                <div class="opt-input-group">
                    <label>Target Crit %</label>
                    <input type="number" id="opt-crit" placeholder="e.g. 20">
                </div>
                <div class="opt-input-group">
                    <label>Target Luck %</label>
                    <input type="number" id="opt-luck" placeholder="e.g. 5">
                </div>
                <div class="opt-input-group">
                    <label style="color:#f7768e">Total Agility (For Haste)</label>
                    <input type="number" id="opt-agi" placeholder="Total Agility Stat">
                </div>
            </div>

            <button class="optimize-btn" onclick="runOptimizer()">Run Smart Optimization</button>
            
            <div class="opt-status" id="opt-status"></div>

            <div class="opt-options">
                <label class="opt-check-label">
                    <input type="checkbox" id="opt-keep-selected"> Keep Selected Gear (Lock P/S)
                </label>
                <label class="opt-check-label">
                    <input type="checkbox" id="opt-optimize-imagine"> Optimize Imagine Slots?
                </label>
                <label class="opt-check-label">
                    <input type="checkbox" id="opt-unlimited-raid"> Allow >4 Raid Armor Pieces
                </label>
            </div>
        </div>

        <div class="imagine-section">
            <div class="imagine-title">Imagine Slots</div>
            
            <div class="imagine-row">
                <span class="slot-name">Imagine 1</span>
                <select id="img-type-1" onchange="calculateAll()">
                    <option value="">- None -</option>
                    <option value="Mastery">Crab (Mastery)</option>
                    <option value="Haste">Flier (Haste)</option>
                    <option value="Versatility">Goblin (Versatility)</option>
                </select>
                <select id="img-lvl-1" onchange="calculateAll()">
                    <option value="3584">Lv 0 (+3584)</option>
                    <option value="4636">Lv 1 (+4636)</option>
                    <option value="5688">Lv 2 (+5688)</option>
                    <option value="6740">Lv 3 (+6740)</option>
                    <option value="7792">Lv 4 (+7792)</option>
                    <option value="8960">Lv 5 (+8960)</option>
                </select>
            </div>

            <div class="imagine-row">
                <span class="slot-name">Imagine 2</span>
                <select id="img-type-2" onchange="calculateAll()">
                    <option value="">- None -</option>
                    <option value="Mastery">Crab (Mastery)</option>
                    <option value="Haste">Flier (Haste)</option>
                    <option value="Versatility">Goblin (Versatility)</option>
                </select>
                <select id="img-lvl-2" onchange="calculateAll()">
                    <option value="3584">Lv 0 (+3584)</option>
                    <option value="4636">Lv 1 (+4636)</option>
                    <option value="5688">Lv 2 (+5688)</option>
                    <option value="6740">Lv 3 (+6740)</option>
                    <option value="7792">Lv 4 (+7792)</option>
                    <option value="8960">Lv 5 (+8960)</option>
                </select>
            </div>
        </div>

        <div class="legendary-note">
            <strong>Gear Values Reference:</strong><br>
            • <strong>Raid Weapon:</strong> 2480 P / 2480 S / + Bonus (No Reforge)<br>
            • <strong>Raid Armor:</strong> 954 P / 954 S / 286 Reforge<br>
            • <strong>Standard Weapon:</strong> 1908 P / 954 S / 572 Reforge<br>
            • <strong>Standard Armor:</strong> 954 P / 477 S / 286 Reforge
        </div>
        
        <div class="footer-credits">
            Produzido por Luxxio // Atualizado por: KrowMeLL
        </div>
    </div>

    <div class="panel calc-panel">
        <h2>Stat Totals</h2>

        <div class="raw-gear-stats">
            <h3 style="margin-top:0; border-bottom:1px solid #444; padding-bottom:10px; font-size:1em; color:#fff;">Total Raw Attributes</h3>
            <div class="raw-row"><span>Versatility:</span> <span class="raw-val" id="raw-vers">0</span></div>
            <div class="raw-row"><span>Mastery:</span> <span class="raw-val" id="raw-mast">0</span></div>
            <div class="raw-row"><span>Haste:</span> <span class="raw-val" id="raw-haste">0</span></div>
            <div class="raw-row"><span>Crit:</span> <span class="raw-val" id="raw-crit">0</span></div>
            <div class="raw-row"><span>Luck:</span> <span class="raw-val" id="raw-luck">0</span></div>
        </div>
        
        <div class="base-stats">
            <div class="input-group">
                <label>Base Vers</label>
                <input type="number" id="base-vers" value="0">
            </div>
            <div class="input-group">
                <label>Base Mastery</label>
                <input type="number" id="base-mast" value="0">
            </div>
            <div class="input-group">
                <label>Base Haste</label>
                <input type="number" id="base-haste" value="0">
            </div>
            <div class="input-group">
                <label>Base Crit</label>
                <input type="number" id="base-crit" value="0">
            </div>
            <div class="input-group">
                <label>Base Luck</label>
                <input type="number" id="base-luck" value="0">
            </div>
            <div class="input-group">
                <label>Base Agility</label>
                <input type="number" id="base-agi" value="0" placeholder="0.2 Haste/pt">
            </div>
        </div>

        <button class="calc-btn" onclick="calculateAll()">Recalculate Stats</button>

        <div class="results-area" id="results">
            <h3>Final Percentages</h3>
            <div class="result-row"><span>Versatility:</span> <span class="result-val" id="r-vers">0%</span></div>
            <div class="result-row"><span>Mastery:</span> <span class="result-val" id="r-mast">6.00%</span></div>
            <div class="result-row"><span>Haste:</span> <span class="result-val" id="r-haste">0%</span></div>
            <div class="result-row"><span>Crit Rate:</span> <span class="result-val" id="r-crit">5.00%</span></div>
            <div class="result-row"><span>Luck:</span> <span class="result-val" id="r-luck">5.00%</span></div>
            
            <div class="result-row" id="raid-special-row" style="display:none; border-top: 2px dashed #7aa2f7; margin-top: 15px; padding-top:10px;">
                <span id="raid-special-label" style="color:#ff9e64; font-weight:bold;">Raid Bonus:</span>
                <span class="result-val" id="raid-special-val" style="color:#ff9e64;">0%</span>
            </div>
            
            <div id="legendary-summary" style="display:none; margin-top:15px; border-top:1px dashed #555; padding-top:10px;">
                <div style="color:#7aa2f7; font-weight:bold; font-size:0.9em; margin-bottom:5px;">Legendary Bonuses</div>
                <div class="raw-row"><span>Cast Spd:</span> <span id="leg-cast" style="color:#9ece6a">0%</span></div>
                <div class="raw-row"><span>Atk Spd:</span> <span id="leg-atk" style="color:#9ece6a">0%</span></div>
            </div>
        </div>
    </div>

</div>

<script>
    /* =========================================
       CONSTANTS & DATA DEFINITIONS
       ========================================= */
    const STATS = ["Versatility", "Mastery", "Haste", "Crit", "Luck"];
    const LEGENDARY_OPTS = ["-", "Attack Speed", "Cast Speed", "ATK/MATK", "Dmg Bonus", "Shield", "Healing Output", "Res Break", "All Res", "Armor", "Max HP"];
    
    // Spec Definitions (Primary/Secondary lock for Raid Gear)
    const CLASS_SPECS = {
        "Vanguard": ["Haste", "Mastery"],
        "Skyward": ["Crit", "Luck"],
        "Shield": ["Haste", "Mastery"],
        "Recovery": ["Crit", "Mastery"],
        "Iado": ["Crit", "Mastery"],
        "Moonstrike": ["Haste", "Luck"],
        "Icicle": ["Crit", "Luck"],
        "Frostbeam": ["Haste", "Mastery"],
        "Smite": ["Mastery", "Luck"],
        "Lifebind": ["Haste", "Mastery"],
        "Earthfort": ["Mastery", "Versatility"],
        "Block": ["Mastery", "Luck"],
        "Wildpack": ["Haste", "Mastery"],
        "Falconry": ["Crit", "Haste"],
        "Dissonance": ["Haste", "Luck"],
        "Concerto": ["Haste", "Crit"]
    };

    const RAID_SLOT_NAMES = ["Weapon", "Helmet", "Chest", "Gloves", "Boots", "Bracelet (L)", "Bracelet (R)"];
    
    const GEM_COLORS = ["Haste", "Crit", "Luck", "Mastery"];
    const IMAGINE_TYPES = ["Mastery", "Haste", "Versatility"];
    const IMAGINE_VALS = [3584, 4636, 5688, 6740, 7792, 8960];
    
    // Stat Restrictions per Slot/Attribute
    const RESTRICTIONS = {
        "Weapon": { "Strength": [], "Intelligence": [], "Agility": [] }, 
        "Helmet": { "Strength": ["Versatility"], "Intelligence": ["Crit"], "Agility": ["Haste"] },
        "Chest": { "Strength": ["Luck"], "Intelligence": ["Crit"], "Agility": ["Mastery"] },
        "Gloves": { "Strength": ["Haste"], "Intelligence": ["Versatility"], "Agility": ["Crit"] },
        "Boots": { "Strength": ["Mastery"], "Intelligence": ["Luck"], "Agility": ["Crit"] },
        "Earrings": { "Strength": ["Mastery"], "Intelligence": ["Versatility"], "Agility": ["Haste"] },
        "Necklace": { "Strength": ["Haste"], "Intelligence": ["Luck"], "Agility": ["Mastery"] },
        "Ring": { "Strength": ["Luck"], "Intelligence": ["Mastery"], "Agility": ["Versatility"] },
        "Bracelet (L)": { "Strength": ["Crit"], "Intelligence": ["Haste"], "Agility": ["Versatility"] },
        "Bracelet (R)": { "Strength": ["Crit"], "Intelligence": ["Mastery"], "Agility": ["Luck"] },
        "Charm": { "Strength": ["Versatility"], "Intelligence": ["Haste"], "Agility": ["Luck"] }
    };

    const GEAR_SLOTS = [
        "Weapon", "Helmet", "Chest", "Gloves", "Boots", 
        "Earrings", "Necklace", "Ring", "Bracelet (L)", "Bracelet (R)", "Charm"
    ];

    // Raid Bonus Table (Season 2)
    const RAID_SPECIAL_DATA = {
        "Block": { label: "Luck", value: 6.0, type: "percent" },
        "Earthfort": { label: "Shield (Versatility)", value: 0.0, type: "percent" },
        "Iado": { label: "Crit DMG", value: 0.0, type: "percent" },
        "Moonstrike": { label: "Luck", value: 0.0, type: "percent" },
        "Icicle": { label: "Crit DMG", value: 0.0, type: "percent" },
        "Frostbeam": { label: "Ranged DMG", value: 0, type: "flat" }, 
        "Vanguard": { label: "Melee DMG", value: 0, type: "flat" }, 
        "Skyward": { label: "Lucky Strike DMG Multiplier", value: 20.0, type: "percent" },
        "Smite": { label: "Ranged DMG", value: 0, type: "flat" }, 
        "Lifebind": { label: "Healing Output", value: 0.0, type: "percent" },
        "Wildpack": { label: "Ranged DMG", value: 0, type: "flat" }, 
        "Falconry": { label: "Crit DMG", value: 0.0, type: "percent" },
        "Recovery": { label: "DMG Bonus", value: 0.0, type: "percent" },
        "Shield": { label: "Melee DMG", value: 0, type: "flat" }, 
        "Concerto": { label: "Crit Healing", value: 0.0, type: "percent" },
        "Dissonance": { label: "Luck Effect DMG Boost", value: 0, type: "flat" } 
    };

    /* =========================================
       INITIALIZATION & UI HELPERS
       ========================================= */

    function init() {
        const container = document.getElementById("gear-container");
        if(!container) return; 
        container.innerHTML = ""; 

        // Populate Class Spec Dropdown
        const specSel = document.getElementById("class-spec");
        Object.keys(CLASS_SPECS).forEach(spec => {
            let opt = document.createElement("option");
            opt.value = spec;
            opt.innerText = spec;
            specSel.appendChild(opt);
        });

        // Generate Gear Grid Rows
        GEAR_SLOTS.forEach((slot, index) => {
            const row = document.createElement("div");
            row.className = "gear-row";
            row.dataset.slot = slot;

            const nameDiv = document.createElement("div");
            nameDiv.className = "slot-name";
            nameDiv.innerText = slot;
            row.appendChild(nameDiv);

            // Raid Checkbox
            const raidDiv = document.createElement("div");
            raidDiv.style.textAlign = "center";
            if (RAID_SLOT_NAMES.includes(slot)) {
                const chk = document.createElement("input");
                chk.type = "checkbox";
                chk.id = "raid-" + index;
                chk.onchange = function() { 
                    toggleRaid(index, slot); 
                    updateRowOptions(index); 
                };
                raidDiv.appendChild(chk);
            }
            row.appendChild(raidDiv);

            // Selectors: Primary, Secondary, Reforge
            for(let i=1; i<=3; i++) {
                const sel = document.createElement("select");
                sel.id = "s" + i + "-" + index;
                sel.innerHTML = '<option value="">-</option>';
                sel.onchange = function() { updateRowOptions(index); };
                row.appendChild(sel);
            }
            
            // Legendary (WIP)
            const legDiv = document.createElement("div");
            legDiv.className = "leg-group";
            const legSel = document.createElement("select");
            legSel.id = "leg-type-" + index;
            LEGENDARY_OPTS.forEach(opt => {
                const o = document.createElement("option");
                o.value = opt;
                o.innerText = opt;
                legSel.appendChild(o);
            });
            const legVal = document.createElement("input");
            legVal.type = "number";
            legVal.id = "leg-val-" + index;
            legVal.className = "leg-val";
            legVal.placeholder = "%";
            
            legDiv.appendChild(legSel);
            legDiv.appendChild(legVal);
            row.appendChild(legDiv);

            container.appendChild(row);
        });

        // Add Listeners to Base Stats Inputs
        document.querySelectorAll('.base-stats input').forEach(input => {
            input.addEventListener('input', calculateAll);
        });

        updateAllRows();
    }

    /* =========================================
       UI INTERACTION LOGIC
       ========================================= */

    function getBuildType() {
        const radios = document.getElementsByName("buildType");
        for(let r of radios) { if(r.checked) return r.value; }
        return "Strength";
    }

    function getCurrentSpecStats() {
        const specName = document.getElementById("class-spec").value;
        return CLASS_SPECS[specName] || ["Haste", "Mastery"];
    }

    function switchTab(tab) {
        document.getElementById('tab-planner').classList.remove('active');
        document.getElementById('tab-optimizer').classList.remove('active');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

        document.getElementById('tab-' + tab).classList.add('active');
        event.target.classList.add('active');
    }

    function updateAllRows() {
        GEAR_SLOTS.forEach((_, index) => {
            updateRowOptions(index);
        });
        calculateAll();
    }

    // Dynamic Options based on Restrictions and Raid status
    function updateRowOptions(index) {
        const slot = GEAR_SLOTS[index];
        const buildType = getBuildType();
        const raidEl = document.getElementById("raid-" + index);
        const isRaid = raidEl ? raidEl.checked : false;

        const s1 = document.getElementById("s1-" + index);
        const s2 = document.getElementById("s2-" + index);
        const s3 = document.getElementById("s3-" + index);

        // If Raid, stats are LOCKED to Spec
        if (isRaid) {
            const specStats = getCurrentSpecStats();
            
            s1.innerHTML = `<option value="${specStats[0]}">${specStats[0]}</option>`;
            s1.value = specStats[0];
            s1.disabled = true;

            s2.innerHTML = `<option value="${specStats[1]}">${specStats[1]}</option>`;
            s2.value = specStats[1];
            s2.disabled = true;
            
            s3.disabled = (slot === "Weapon");
            if(slot === "Weapon") s3.value = "";
            else populateStandard(s3, s3.value, null, false, []); 

            return; 
        }

        s1.disabled = false;
        s2.disabled = false;
        s3.disabled = false;

        let tableBanned = [];
        if(RESTRICTIONS[slot] && RESTRICTIONS[slot][buildType]) {
            tableBanned = RESTRICTIONS[slot][buildType];
        }

        const currentS1 = s1.value;
        const currentS2 = s2.value;
        const currentS3 = s3.value;

        populateStandard(s1, currentS1, currentS2, true, tableBanned);
        populateStandard(s2, currentS2, currentS1, true, tableBanned);
        populateStandard(s3, currentS3, null, false, []);
    }

    function populateStandard(selElement, currentVal, excludeVal, isRestricted, bannedList) {
        selElement.innerHTML = '<option value="">-</option>';
        STATS.forEach(stat => {
            if(isRestricted && bannedList.includes(stat)) return;
            if(stat === excludeVal) return;
            const opt = document.createElement("option");
            opt.value = stat;
            opt.innerText = stat;
            selElement.appendChild(opt);
        });
        if (currentVal && Array.from(selElement.options).some(o => o.value === currentVal)) {
            selElement.value = currentVal;
        } else {
            selElement.value = "";
        }
    }

    function toggleRaid(index, slotName) {
        const chk = document.getElementById("raid-" + index);
        const legType = document.getElementById("leg-type-" + index);
        const legVal = document.getElementById("leg-val-" + index);
        
        if(!chk) return;
        const isRaid = chk.checked;
        
        // Disable Legendary inputs if Raid is active
        legType.disabled = isRaid;
        legVal.disabled = isRaid;
        if(isRaid) {
            legType.value = "-";
            legVal.value = "";
        }
    }

    function applyGlobal(type, value) {
        if(!value) return;
        GEAR_SLOTS.forEach((_, index) => {
            if(type === 'reforge') {
                const s3 = document.getElementById("s3-" + index);
                if(!s3.disabled) s3.value = value;
            }
        });
        calculateAll();
    }

    function clearPlannerForOptimization(keepSelected) {
        if(keepSelected) return;

        GEAR_SLOTS.forEach((_, index) => {
            const raidChk = document.getElementById("raid-" + index);
            if(raidChk) {
                raidChk.checked = false;
                toggleRaid(index, GEAR_SLOTS[index]);
            }
        });
        updateAllRows();
    }

    /* =========================================
       OPTIMIZER LOGIC (PERFORMANCE OPTIMIZED)
       ========================================= */

    function runOptimizer() {
        // 1. PRE-FETCH DATA: Ler o DOM uma única vez para criar um contexto estático.
        // Isso evita leitura de disco/DOM dentro do loop de 20.000 iterações.
        const targets = {
            v: parseFloat(document.getElementById('opt-vers').value) || 0,
            m: parseFloat(document.getElementById('opt-mast').value) || 0,
            h: parseFloat(document.getElementById('opt-haste').value) || 0,
            c: parseFloat(document.getElementById('opt-crit').value) || 0,
            l: parseFloat(document.getElementById('opt-luck').value) || 0
        };

        const context = {
            baseVers: parseFloat(document.getElementById('base-vers').value) || 0,
            baseMast: parseFloat(document.getElementById('base-mast').value) || 0,
            baseHaste: parseFloat(document.getElementById('base-haste').value) || 0,
            baseCrit: parseFloat(document.getElementById('base-crit').value) || 0,
            baseLuck: parseFloat(document.getElementById('base-luck').value) || 0,
            extraHaste: (parseFloat(document.getElementById('opt-agi').value) || 0) * 0.2,
            specName: document.getElementById("class-spec").value,
            specialBonus: RAID_SPECIAL_DATA[document.getElementById("class-spec").value] || null
        };

        const allowUnlimitedRaid = document.getElementById('opt-unlimited-raid').checked;
        const keepSelected = document.getElementById('opt-keep-selected').checked;
        const optImagine = document.getElementById('opt-optimize-imagine').checked;

        const buildType = getBuildType();
        const specStats = getCurrentSpecStats();
        
        const statusEl = document.getElementById('opt-status');
        statusEl.innerText = "Optimizing... (Running Intelligent Hill Climb)";

        // Limpa a tela (visual) antes de começar
        clearPlannerForOptimization(keepSelected);

        // setTimeout para dar tempo da UI atualizar a mensagem "Optimizing..."
        setTimeout(() => {
            let bestGlobalLayout = null;
            let bestGlobalDiff = Infinity;
            
            const RESTARTS = 15;
            const ITERATIONS = 1200; 

            for(let restart=0; restart < RESTARTS; restart++) {
                
                let currentLayout = generateInitialLayout(buildType, specStats, keepSelected, optImagine, allowUnlimitedRaid);
                // Calculadora OTIMIZADA recebe o Contexto, não lê o DOM
                let currentStats = calcSimulatedStats(currentLayout, context);
                let currentDiff = getDiff(currentLayout, currentStats, targets);

                for(let i=0; i < ITERATIONS; i++) {
                    let mutant = JSON.parse(JSON.stringify(currentLayout));
                    mutateLayout(mutant, buildType, specStats, optImagine);
                    
                    let mutantStats = calcSimulatedStats(mutant, context);
                    let mutantDiff = getDiff(mutant, mutantStats, targets);

                    if(mutantDiff < currentDiff) {
                        currentLayout = mutant;
                        currentDiff = mutantDiff;
                    }
                }

                if(currentDiff < bestGlobalDiff) {
                    bestGlobalDiff = currentDiff;
                    bestGlobalLayout = currentLayout;
                }
            }

            // Aplicar o melhor resultado encontrado
            applyLayout(bestGlobalLayout);
            statusEl.innerText = "Optimization Complete! Results applied.";
            switchTab('planner'); 
            calculateAll();
        }, 50);
    }

    // Função de diferença (Fitness Function)
    function getDiff(layout, stats, t) {
        // 1. PRIMARY: Match Stats
        let statPenalty = Math.abs(stats.v - t.v) + 
                          Math.abs(stats.m - t.m) + 
                          Math.abs(stats.h - t.h) + 
                          Math.abs(stats.c - t.c) + 
                          Math.abs(stats.l - t.l);

        // 2. SECONDARY: Minimize Gem Levels (Prefer Lv 5 > Lv 7)
        let gemLevelPenalty = 0;
        layout.gears.forEach(g => {
            if(g && g.gLvl) {
                gemLevelPenalty += (g.gLvl - 5) * 0.0001; 
            }
        });

        // 3. TERTIARY: Maximize Uniformity (Same color gems)
        let colorCounts = {};
        let maxCount = 0;
        layout.gears.forEach(g => {
            if(g && g.g) {
                colorCounts[g.g] = (colorCounts[g.g] || 0) + 1;
                if(colorCounts[g.g] > maxCount) maxCount = colorCounts[g.g];
            }
        });
        let varietyPenalty = (11 - maxCount) * 0.00001;

        return statPenalty + gemLevelPenalty + varietyPenalty;
    }

    function generateInitialLayout(buildType, specStats, keepSelected, optImagine, allowUnlimitedRaid) {
        let layout = { gears: [], imagine: [] };
        let lockedSlots = [];
        let raidCount = 0;

        // Se "Keep Selected" estiver marcado, lê o estado atual
        if (keepSelected) {
            GEAR_SLOTS.forEach((slot, index) => {
                let s1 = document.getElementById("s1-" + index).value;
                if (s1 !== "") {
                    let isRaid = document.getElementById("raid-" + index)?.checked || false;
                    let p = s1;
                    let s = document.getElementById("s2-" + index).value;
                    let r = document.getElementById("s3-" + index).value;
                    let g = "Haste"; // Default gem logic simplify
                    let gLvl = 5;
                    
                    layout.gears.push({ isLocked: true, isRaid, p, s, r, g, gLvl });
                    lockedSlots.push(index);
                    if(isRaid) raidCount++;
                } else {
                    layout.gears.push(null); 
                }
            });
        } else {
            GEAR_SLOTS.forEach(() => layout.gears.push(null));
        }

        // Preenche slots vazios
        let emptyIndices = GEAR_SLOTS.map((_, i) => i).filter(i => !lockedSlots.includes(i));
        
        // Lógica de Raid
        let weaponLocked = lockedSlots.includes(0);
        let weaponRaidLocked = weaponLocked && layout.gears[0].isRaid;
        let makeWeaponRaid = (!weaponLocked) ? true : weaponRaidLocked;

        let armorIndices = [1, 2, 3, 4, 8, 9];
        let lockedRaidArmors = lockedSlots.filter(i => armorIndices.includes(i) && layout.gears[i].isRaid).length;
        
        let target = allowUnlimitedRaid ? (Math.random()>0.5?5:6) : 4;
        let needed = Math.max(0, target - lockedRaidArmors);
        
        let availableArmorIndices = emptyIndices.filter(i => armorIndices.includes(i));
        availableArmorIndices.sort(() => Math.random() - 0.5);
        let indicesToMakeRaid = availableArmorIndices.slice(0, needed);

        if(!weaponLocked && makeWeaponRaid) indicesToMakeRaid.push(0);

        // Seed Gem
        let seedGem = GEM_COLORS[Math.floor(Math.random() * GEM_COLORS.length)];

        // Fill Data
        emptyIndices.forEach(index => {
            let slot = GEAR_SLOTS[index];
            let isRaid = indicesToMakeRaid.includes(index);
            
            let p, s;
            if (isRaid) {
                p = specStats[0];
                s = specStats[1];
            } else {
                let banned = (RESTRICTIONS[slot] && RESTRICTIONS[slot][buildType]) ? RESTRICTIONS[slot][buildType] : [];
                let validPrimary = STATS.filter(st => !banned.includes(st));
                p = validPrimary[Math.floor(Math.random() * validPrimary.length)];
                let validSecondary = validPrimary.filter(st => st !== p);
                s = validSecondary[Math.floor(Math.random() * validSecondary.length)];
            }

            let r = STATS[Math.floor(Math.random() * STATS.length)];
            if(slot === "Weapon" && isRaid) r = ""; 

            let g = seedGem;
            let gLvl = 5;

            layout.gears[index] = { isLocked: false, isRaid, p, s, r, g, gLvl };
        });

        // Imagine Logic
        if (optImagine) {
            layout.imagine = [
                { t: IMAGINE_TYPES[Math.floor(Math.random()*3)], v: IMAGINE_VALS[Math.floor(Math.random()*6)] },
                { t: IMAGINE_TYPES[Math.floor(Math.random()*3)], v: IMAGINE_VALS[Math.floor(Math.random()*6)] }
            ];
        } else {
            layout.imagine = [
                { t: document.getElementById("img-type-1").value, v: parseInt(document.getElementById("img-lvl-1").value)||0 },
                { t: document.getElementById("img-type-2").value, v: parseInt(document.getElementById("img-lvl-2").value)||0 }
            ];
        }

        return layout;
    }

    function mutateLayout(layout, buildType, specStats, optImagine) {
        let idx = Math.floor(Math.random() * layout.gears.length);
        let gear = layout.gears[idx];
        let slotName = GEAR_SLOTS[idx];

        // Aspects: 0=P, 1=S, 2=R, 3=GemColor, 4=GemLvl
        let validAspects = [2, 3, 4];
        if (!gear.isLocked && !gear.isRaid) {
            validAspects.push(0, 1);
        }

        if (optImagine && Math.random() < 0.2) { 
             let imIdx = Math.floor(Math.random() * 2);
             if(Math.random() < 0.5) layout.imagine[imIdx].t = IMAGINE_TYPES[Math.floor(Math.random()*3)];
             else layout.imagine[imIdx].v = IMAGINE_VALS[Math.floor(Math.random()*6)];
             return;
        }

        let aspect = validAspects[Math.floor(Math.random() * validAspects.length)];
        let banned = (!gear.isRaid && RESTRICTIONS[slotName] && RESTRICTIONS[slotName][buildType]) ? RESTRICTIONS[slotName][buildType] : [];

        if (aspect === 0) { 
            let validPrimary = STATS.filter(s => !banned.includes(s));
            gear.p = validPrimary[Math.floor(Math.random() * validPrimary.length)];
            if(gear.p === gear.s) {
                 let validS = validPrimary.filter(s => s !== gear.p);
                 gear.s = validS[Math.floor(Math.random() * validS.length)];
            }
        } else if (aspect === 1) { 
             let validPrimary = STATS.filter(s => !banned.includes(s));
             let validSecondary = validPrimary.filter(s => s !== gear.p);
             gear.s = validSecondary[Math.floor(Math.random() * validSecondary.length)];
        } else if (aspect === 2) { 
             if (!(slotName === "Weapon" && gear.isRaid)) {
                gear.r = STATS[Math.floor(Math.random() * STATS.length)];
             }
        } else if (aspect === 3) { 
             gear.g = GEM_COLORS[Math.floor(Math.random() * GEM_COLORS.length)];
        } else if (aspect === 4) { 
             gear.gLvl = 5 + Math.floor(Math.random() * 3);
        }
    }

    // --- FUNÇÃO OTIMIZADA: Usa CONTEXTO em vez de DOM ---
    function calcSimulatedStats(layout, context) {
        let raw = { "Versatility": 0, "Mastery": 0, "Haste": 0, "Crit": 0, "Luck": 0 };

        // 1. Usa os valores do contexto (RAM)
        raw["Versatility"] += context.baseVers;
        raw["Mastery"]     += context.baseMast;
        raw["Haste"]       += context.baseHaste + context.extraHaste;
        raw["Crit"]        += context.baseCrit;
        raw["Luck"]        += context.baseLuck;

        // 2. Soma Imagines
        layout.imagine.forEach(im => {
            if(im.t && raw[im.t] !== undefined) raw[im.t] += im.v;
        });

        // 3. Soma Equipamentos (Gears)
        layout.gears.forEach((gear, index) => {
            if (!gear) return;

            let slot = GEAR_SLOTS[index];
            let isRaid = gear.isRaid;

            let v1=0, v2=0, v3=0;
            if(slot === "Weapon") {
                if(isRaid) { v1=2480; v2=2480; v3=0; }
                else { v1=1908; v2=954; v3=572; }
            } else if (isRaid) {
                v1=954; v2=954; v3=286;
            } else {
                v1=954; v2=477; v3=286;
            }

            if(gear.p) raw[gear.p] += v1;
            if(gear.s) raw[gear.s] += v2;
            if(gear.r) raw[gear.r] += v3;

            let gemVal = (gear.gLvl===5)?50 : (gear.gLvl===6)?60 : 70;
            if(gear.g) raw[gear.g] += gemVal;
        });

        // 4. Aplica Lógica de Raid (Usando Contexto)
        const specialBonus = context.specialBonus;
        // Verifica se a arma no layout simulado é Raid
        const hasRaidWeapon = layout.gears[0] && layout.gears[0].isRaid;

        if (hasRaidWeapon && specialBonus && specialBonus.type === "percent") {
            if (specialBonus.label === "Luck") {
                raw["Luck"] = raw["Luck"] * (1 + (specialBonus.value / 100));
            }
            if (specialBonus.label === "Shield (Versatility)") {
                raw["Versatility"] = raw["Versatility"] * (1 + (specialBonus.value / 100));
            }
        }

        return {
            v: (raw["Versatility"] / (raw["Versatility"] + 11200)) * 100,
            m: ((raw["Mastery"] / (raw["Mastery"] + 20000)) * 100) + 6,
            h: (raw["Haste"] / (raw["Haste"] + 20000)) * 100,
            c: ((raw["Crit"] / (raw["Crit"] + 20000)) * 100) + 5,
            l: ((raw["Luck"] / (raw["Luck"] + 16230)) * 100) + 5
        };
    }

    function applyLayout(layout) {
        layout.gears.forEach((gear, index) => {
            let slot = GEAR_SLOTS[index];
            let chk = document.getElementById("raid-" + index);
            if(chk) {
                chk.checked = gear.isRaid;
                toggleRaid(index, slot);
            }
            document.getElementById("s1-" + index).value = gear.p;
            updateRowOptions(index); 
            document.getElementById("s2-" + index).value = gear.s;
            document.getElementById("s3-" + index).value = gear.r;
            // Gemas não estavam visíveis no HTML original, mas o layout suporta. 
            // A lógica mantém consistência interna.
        });

        document.getElementById("img-type-1").value = layout.imagine[0].t;
        document.getElementById("img-lvl-1").value = layout.imagine[0].v;
        document.getElementById("img-type-2").value = layout.imagine[1].t;
        document.getElementById("img-lvl-2").value = layout.imagine[1].v;
    }

    /* =========================================
       MAIN UI CALCULATOR
       ========================================= */

    function calculateAll() {
        let gearTotal = { "Versatility": 0, "Mastery": 0, "Haste": 0, "Crit": 0, "Luck": 0 };
        let legBonuses = { "Attack Speed": 0, "Cast Speed": 0 };

        // Itera sobre o DOM atual para calcular stats
        GEAR_SLOTS.forEach((slot, index) => {
            const s1 = document.getElementById("s1-" + index).value;
            const s2 = document.getElementById("s2-" + index).value;
            const s3 = document.getElementById("s3-" + index).value;
            const raidEl = document.getElementById("raid-" + index);
            
            let isRaid = raidEl ? raidEl.checked : false;
            let v1=0, v2=0, v3=0;
            
            // Lógica de Valores
            if(slot === "Weapon") {
                if(isRaid) {
                    v1 = 2480; v2 = 2480; v3 = 0; 
                    const specName = document.getElementById("class-spec").value;
                    window.currentRaidBonus = RAID_SPECIAL_DATA[specName] || null;
                } else {
                    v1 = 1908; v2 = 954; v3 = 572; 
                    window.currentRaidBonus = null; 
                }
            } else if (isRaid) {
                v1 = 954; v2 = 954; v3 = 286;
            } else {
                v1 = 954; v2 = 477; v3 = 286;
            }

            if(s1 && gearTotal[s1] !== undefined) gearTotal[s1] += v1;
            if(s2 && gearTotal[s2] !== undefined) gearTotal[s2] += v2;
            if(s3 && gearTotal[s3] !== undefined) gearTotal[s3] += v3;

            if(!isRaid) {
                const lType = document.getElementById("leg-type-" + index).value;
                const lVal = parseFloat(document.getElementById("leg-val-" + index).value) || 0;
                if(lType === "Attack Speed") legBonuses["Attack Speed"] += lVal;
                if(lType === "Cast Speed") legBonuses["Cast Speed"] += lVal;
            }
        });

        // Processa Imagines
        const processImagine = (num) => {
            const type = document.getElementById("img-type-" + num).value;
            const val = parseInt(document.getElementById("img-lvl-" + num).value) || 0;
            if(type && gearTotal[type] !== undefined) gearTotal[type] += val;
        };
        processImagine(1); processImagine(2);

        // Soma Bases + Agilidade
        let finalTotal = { ...gearTotal };
        let baseVers = parseFloat(document.getElementById('base-vers').value) || 0;
        let baseMast = parseFloat(document.getElementById('base-mast').value) || 0;
        let baseHaste = parseFloat(document.getElementById('base-haste').value) || 0;
        let baseCrit = parseFloat(document.getElementById('base-crit').value) || 0;
        let baseLuck = parseFloat(document.getElementById('base-luck').value) || 0;
        let agiVal = parseFloat(document.getElementById('base-agi').value) || 0;
        let agiHaste = agiVal * 0.2;

        finalTotal["Versatility"] += baseVers;
        finalTotal["Mastery"] += baseMast;
        finalTotal["Haste"] += baseHaste + agiHaste;
        finalTotal["Crit"] += baseCrit;
        finalTotal["Luck"] += baseLuck;

        // Aplica Bônus de Raid (Multiplicadores)
        const specialBonus = window.currentRaidBonus;
        if (specialBonus && specialBonus.type === "percent") {
            if (specialBonus.label === "Luck") {
                finalTotal["Luck"] = finalTotal["Luck"] * (1 + (specialBonus.value / 100));
            }
            if (specialBonus.label === "Shield (Versatility)") {
                finalTotal["Versatility"] = finalTotal["Versatility"] * (1 + (specialBonus.value / 100));
            }
        }

        // Atualiza UI com Raw Stats
        document.getElementById("raw-vers").innerText = finalTotal["Versatility"].toFixed(0);
        document.getElementById("raw-mast").innerText = finalTotal["Mastery"].toFixed(0);
        document.getElementById("raw-haste").innerText = finalTotal["Haste"].toFixed(1);
        document.getElementById("raw-crit").innerText = finalTotal["Crit"].toFixed(0);
        document.getElementById("raw-luck").innerText = finalTotal["Luck"].toFixed(0);

        // Fórmulas de Conversão (%)
        let vPct = (finalTotal["Versatility"] / (finalTotal["Versatility"] + 11200)) * 100;
        let mPct = ((finalTotal["Mastery"] / (finalTotal["Mastery"] + 20000)) * 100) + 6;
        let hPct = (finalTotal["Haste"] / (finalTotal["Haste"] + 20000)) * 100;
        let cPct = ((finalTotal["Crit"] / (finalTotal["Crit"] + 20000)) * 100) + 5;
        let lPct = ((finalTotal["Luck"] / (finalTotal["Luck"] + 16230)) * 100) + 5;

        // Atualiza UI com Porcentagens
        document.getElementById('r-vers').innerText = isNaN(vPct) ? "0%" : vPct.toFixed(2) + "%";
        document.getElementById('r-mast').innerText = isNaN(mPct) ? "6.00%" : mPct.toFixed(2) + "%";
        document.getElementById('r-haste').innerText = isNaN(hPct) ? "0%" : hPct.toFixed(2) + "%";
        document.getElementById('r-crit').innerText = isNaN(cPct) ? "5.00%" : cPct.toFixed(2) + "%";
        document.getElementById('r-luck').innerText = isNaN(lPct) ? "5.00%" : lPct.toFixed(2) + "%";

        // Exibição de Raid Bônus Texto
        const raidRow = document.getElementById('raid-special-row');
        if (specialBonus) {
            raidRow.style.display = 'flex';
            document.getElementById('raid-special-label').innerText = "Raid " + specialBonus.label + ":";
            let suffix = specialBonus.type === "percent" ? "%" : "";
            document.getElementById('raid-special-val').innerText = "+" + specialBonus.value + suffix;
        } else {
            raidRow.style.display = 'none';
        }

        // Exibição de Lendários
        if(legBonuses["Attack Speed"] > 0 || legBonuses["Cast Speed"] > 0) {
            document.getElementById('legendary-summary').style.display = 'block';
            document.getElementById('leg-atk').innerText = "+" + legBonuses["Attack Speed"] + "%";
            document.getElementById('leg-cast').innerText = "+" + legBonuses["Cast Speed"] + "%";
        } else {
            document.getElementById('legendary-summary').style.display = 'none';
        }
    }

    // Run on load
    window.addEventListener("DOMContentLoaded", init);

</script>

</body>
</html>
